@echo off
chcp 65001 >nul
setlocal DisableDelayedExpansion
title üé≠ –î–µ–º–æ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—à–∏–±–æ–∫ - Transaction Saga
color 0A

:: ==============================================================================
:: –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
:: ==============================================================================
set DB_HOST=localhost
set DB_PORT=5432
set DB_NAME=kefir_db
set DB_USER=postgres
set SAGA_URL=http://localhost:8090/transaction-saga

:: ==============================================================================
:: –ó–ê–ì–û–õ–û–í–û–ö –ò –í–í–û–î –ü–ê–†–û–õ–Ø
:: ==============================================================================
cls
echo ================================================================================
echo üé≠ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ö–ê–°–ö–ê–î–ù–´–• –û–®–ò–ë–û–ö - Transaction Saga Pattern
echo ================================================================================
echo.
echo üìä –¶–µ–ª—å: –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∏—Å—Ç–∏–∫–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
echo üìä –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –±–∞–∑–∞: %DB_NAME%
echo üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: %DB_USER%
echo.
echo üîë –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å Ghbdtnbr123! (—Å –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –∑–Ω–∞–∫–æ–º)
echo.
set /p DB_PASSWORD="üîê –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å PostgreSQL: "
if "%DB_PASSWORD%"=="" set DB_PASSWORD=Ghbdtnbr123!

:: ==============================================================================
:: –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –í–´–ü–û–õ–ù–ï–ù–ò–Ø PSQL –° –ü–ê–†–û–õ–ï–ú
:: ==============================================================================
:PSQL_WITH_PASSWORD
set "SQL_COMMAND=%~1"
set "DB_TARGET=%~2"
if "%DB_TARGET%"=="" set DB_TARGET=%DB_NAME%

:: –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ PGPASSWORD (–æ—Å–Ω–æ–≤–Ω–æ–π)
set PGPASSWORD=%DB_PASSWORD%
psql -h %DB_HOST% -p %DB_PORT% -U %DB_USER% -d %DB_TARGET% -c "%SQL_COMMAND%" 2>nul
set PSQL_RESULT=%errorlevel%
set PGPASSWORD=

if %PSQL_RESULT% equ 0 exit /b 0

:: –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ —Ñ–∞–π–ª –ø–∞—Ä–æ–ª—è
echo %DB_PASSWORD% > "%TEMP%\pgpass_%RANDOM%.txt"
set PGPASSFILE="%TEMP%\pgpass_%RANDOM%.txt"
psql -h %DB_HOST% -p %DB_PORT% -U %DB_USER% -d %DB_TARGET% -c "%SQL_COMMAND%" 2>nul
set PSQL_RESULT=%errorlevel%
set PGPASSFILE=
del "%TEMP%\pgpass_*.txt" 2>nul

exit /b %PSQL_RESULT%

:: ==============================================================================
:: –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ô
:: ==============================================================================
cls
echo ================================================================================
echo üîç –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ù–û–°–¢–ò –°–ï–†–í–ò–°–û–í
echo ================================================================================
echo.

echo üì° –ü—Ä–æ–≤–µ—Ä—è–µ–º Transaction Saga...
curl -s -o nul -w "%%{http_code}" "%SAGA_URL%/api/health" > "%TEMP%\saga_response.txt" 2>nul
set /p SAGA_STATUS=<"%TEMP%\saga_response.txt"
del "%TEMP%\saga_response.txt" 2>nul

if "%SAGA_STATUS%"=="200" (
    echo ‚úÖ Transaction Saga –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP %SAGA_STATUS%)
    set SAGA_AVAILABLE=1
) else (
    echo ‚ö† Transaction Saga –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (HTTP: %SAGA_STATUS%)
    echo üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –Ω–∞ –ø–æ—Ä—Ç—É 8090
    set SAGA_AVAILABLE=0
)

echo.
echo üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î %DB_NAME%...
echo.

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
call :PSQL_WITH_PASSWORD "SELECT '‚úÖ PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç', version();" "postgres"
if %errorlevel% equ 0 (
    echo ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å–ø–µ—à–Ω–æ
    set PG_AVAILABLE=1
    
    :: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã kefir_db
    call :PSQL_WITH_PASSWORD "\c %DB_NAME%" "postgres" 2>nul
    if %errorlevel% equ 0 (
        echo ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö %DB_NAME% —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        set DB_AVAILABLE=1
    ) else (
        echo ‚ö† –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö %DB_NAME% –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        echo üîß –°–æ–∑–¥–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...
        call :PSQL_WITH_PASSWORD "CREATE DATABASE %DB_NAME%;" "postgres"
        if %errorlevel% equ 0 (
            echo ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö %DB_NAME% —Å–æ–∑–¥–∞–Ω–∞
            set DB_AVAILABLE=1
        ) else (
            echo ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            set DB_AVAILABLE=0
        )
    )
) else (
    echo ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL
    echo.
    echo üìã –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´:
    echo 1. PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω
    echo 2. –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å: %DB_PASSWORD%
    echo 3. –ü–æ—Ä—Ç 5432 –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–æ–º
    echo.
    echo üí° –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:
    echo - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª—É–∂–±—É: sc query postgresql
    echo - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É: net start postgresql-x64-15
    echo - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç: netstat -an | findstr :5432
    echo.
    set PG_AVAILABLE=0
    set DB_AVAILABLE=0
)

echo.
if "%SAGA_AVAILABLE%"=="0" (
    echo ‚ö† –í–ù–ò–ú–ê–ù–ò–ï: Transaction Saga –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
    echo –î–µ–º–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é Saga Pattern
    echo.
)

if "%DB_AVAILABLE%"=="0" (
    echo ‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –ë–î –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞
    echo –î–µ–º–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
    echo.
)

echo üì¢ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!
echo –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–ª–∞–≤–∏—à—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...
pause >nul

:: ==============================================================================
:: –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
:: ==============================================================================
:MAIN_MENU
cls
echo ================================================================================
echo üé≠ –î–ï–ú–û –ö–ê–°–ö–ê–î–ù–´–• –û–®–ò–ë–û–ö - –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
echo ================================================================================
if "%SAGA_AVAILABLE%"=="1" (
    echo üåê Saga: %SAGA_URL% ‚úÖ
) else (
    echo üåê Saga: %SAGA_URL% ‚ö† (—Å–∏–º—É–ª—è—Ü–∏—è)
)

if "%DB_AVAILABLE%"=="1" (
    echo üóÑÔ∏è –ë–î: %DB_NAME% ‚úÖ
) else (
    echo üóÑÔ∏è –ë–î: %DB_NAME% ‚ö† (—Å–∏–º—É–ª—è—Ü–∏—è)
)
echo.
echo [1] üìä –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
echo [2] üü¢ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
echo [3] ‚ö† –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–¥–∏–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä
echo [4] üî• –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ—à–∏–±–∫–∏ (–ì–õ–ê–í–ù–´–ô!)
echo [5] üèÉ –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ö–ª–∏–µ–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã
echo [6] üåô –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ù–æ—á–Ω–æ–π –∫–æ—à–º–∞—Ä (–º–∞–≥–∞–∑–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç—ã)
echo [7] üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
echo [8] üßπ –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
echo [9] üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ
echo [0] ‚ùå –í—ã—Ö–æ–¥
echo.
set /p MENU_CHOICE="üìã –í–∞—à –≤—ã–±–æ—Ä (0-9): "

if "%MENU_CHOICE%"=="1" goto PREPARE_DATA
if "%MENU_CHOICE%"=="2" goto SCENARIO_1
if "%MENU_CHOICE%"=="3" goto SCENARIO_2
if "%MENU_CHOICE%"=="4" goto SCENARIO_3
if "%MENU_CHOICE%"=="5" goto SCENARIO_4
if "%MENU_CHOICE%"=="6" goto SCENARIO_5
if "%MENU_CHOICE%"=="7" goto SHOW_STATE
if "%MENU_CHOICE%"=="8" goto CLEAR_DATA
if "%MENU_CHOICE%"=="9" goto RESTART_DEMO
if "%MENU_CHOICE%"=="0" exit /b
goto MAIN_MENU

:: ==============================================================================
:: 1. –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–•
:: ==============================================================================
:PREPARE_DATA
cls
echo ================================================================================
echo üìä –ü–û–î–ì–û–¢–û–í–ö–ê –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–•
echo ================================================================================
echo.

if "%DB_AVAILABLE%"=="0" (
    echo ‚ö† –ë–î –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–º—É–ª—è—Ü–∏—é
    echo üì¶ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–∞–º—è—Ç–∏
    goto :DATA_PREPARED
)

echo üóÉÔ∏è –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
call :PSQL_WITH_PASSWORD "
-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
CREATE TABLE IF NOT EXISTS products (
    id SERIAL PRIMARY KEY,
    product_id VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    stock INTEGER DEFAULT 0,
    warehouse VARCHAR(50) DEFAULT 'main',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE IF NOT EXISTS orders (
    id SERIAL PRIMARY KEY,
    order_id VARCHAR(50) UNIQUE NOT NULL,
    client_id VARCHAR(50) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',
    total_amount DECIMAL(10,2) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –¢–∞–±–ª–∏—Ü–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–∫–∞–∑–∞
CREATE TABLE IF NOT EXISTS order_items (
    id SERIAL PRIMARY KEY,
    order_id VARCHAR(50) NOT NULL,
    product_id VARCHAR(50) NOT NULL,
    quantity INTEGER NOT NULL,
    scanned INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'pending',
    FOREIGN KEY (order_id) REFERENCES orders(order_id)
);
" 2>nul && echo ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î —Å–æ–∑–¥–∞–Ω–∞

echo.
echo üì¶ –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã...
call :PSQL_WITH_PASSWORD "
INSERT INTO products (product_id, name, price, stock, warehouse) VALUES
('MILK-1L', '–ú–æ–ª–æ–∫–æ 1–ª', 89.99, 50, 'main'),
('BREAD', '–•–ª–µ–±', 45.50, 30, 'main'),
('BUTTER', '–ú–∞—Å–ª–æ', 199.99, 20, 'main'),
('EGGS', '–Ø–π—Ü–∞ 10—à—Ç', 129.99, 100, 'main'),
('CHEESE', '–°—ã—Ä', 349.99, 15, 'main'),
('YOGURT', '–ô–æ–≥—É—Ä—Ç', 59.99, 40, 'cold'),
('MEAT', '–ú—è—Å–æ', 499.99, 25, 'cold'),
('VEGGIES', '–û–≤–æ—â–∏', 199.99, 60, 'cold'),
('FRUITS', '–§—Ä—É–∫—Ç—ã', 299.99, 35, 'cold'),
('WATER', '–í–æ–¥–∞ 5–ª', 99.99, 100, 'main')
ON CONFLICT (product_id) DO UPDATE SET
stock = EXCLUDED.stock,
warehouse = EXCLUDED.warehouse;
" 2>nul && echo ‚úÖ –¢–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ë–î

echo.
echo üë• –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
set CLIENT_ID=CLIENT-%RANDOM%
set COLLECTOR_ID=COLLECTOR-%RANDOM%
set ORDER_ID=ORDER-%RANDOM%-%TIME:~6,2%

:DATA_PREPARED
echo.
echo ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã!
echo üë§ –ö–ª–∏–µ–Ω—Ç: %CLIENT_ID%
echo üë∑ –°–±–æ—Ä—â–∏–∫: %COLLECTOR_ID%
echo üì¶ –ó–∞–∫–∞–∑: %ORDER_ID%
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 2. –°–¶–ï–ù–ê–†–ò–ô 1: –ù–û–†–ú–ê–õ–¨–ù–´–ô –ü–†–û–¶–ï–°–°
:: ==============================================================================
:SCENARIO_1
cls
echo ================================================================================
echo üü¢ –°–¶–ï–ù–ê–†–ò–ô 1: –ù–û–†–ú–ê–õ–¨–ù–´–ô –ü–†–û–¶–ï–°–° (–£–°–ü–ï–®–ù–´–ô)
echo ================================================================================
echo.

echo üìù –°–∏–º—É–ª–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –∑–∞–∫–∞–∑:
echo - –ö–ª–∏–µ–Ω—Ç: %CLIENT_ID%
echo - –°–±–æ—Ä—â–∏–∫: %COLLECTOR_ID%
echo - –¢–æ–≤–∞—Ä—ã: –ú–æ–ª–æ–∫–æ, –•–ª–µ–±, –ú–∞—Å–ª–æ
echo.

echo üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏:
timeout /t 1 /nobreak >nul
echo 1. üì± –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑... ‚úì
timeout /t 1 /nobreak >nul
echo 2. üì¶ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã... ‚úì
timeout /t 1 /nobreak >nul
echo 3. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ú–æ–ª–æ–∫–æ... ‚úì
timeout /t 1 /nobreak >nul
echo 4. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –•–ª–µ–±... ‚úì
timeout /t 1 /nobreak >nul
echo 5. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ú–∞—Å–ª–æ... ‚úì
timeout /t 1 /nobreak >nul
echo 6. üöö –ö—É—Ä—å–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–∫–∞–∑... ‚úì
timeout /t 1 /nobreak >nul
echo 7. üè† –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã... ‚úì
echo.
echo üéâ –ó–ê–ö–ê–ó –£–°–ü–ï–®–ù–û –í–´–ü–û–õ–ù–ï–ù!
echo ‚è±Ô∏è –í—Ä–µ–º—è: 15 –º–∏–Ω—É—Ç
echo üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 335.48 —Ä—É–±
echo üòä –ö–ª–∏–µ–Ω—Ç –¥–æ–≤–æ–ª–µ–Ω
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 3. –°–¶–ï–ù–ê–†–ò–ô 2: –û–î–ò–ù –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ô –¢–û–í–ê–†
:: ==============================================================================
:SCENARIO_2
cls
echo ================================================================================
echo ‚ö† –°–¶–ï–ù–ê–†–ò–ô 2: –û–î–ò–ù –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ô –¢–û–í–ê–†
echo ================================================================================
echo.

echo üìù –°–∏–º—É–ª–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∑–∞–∫–∞–∑:
echo - –ö–ª–∏–µ–Ω—Ç: %CLIENT_ID%
echo - –°–±–æ—Ä—â–∏–∫: %COLLECTOR_ID%
echo - –¢–æ–≤–∞—Ä—ã: –ú–æ–ª–æ–∫–æ, –•–ª–µ–±, –ô–æ–≥—É—Ä—Ç
echo.

echo üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ —Å –æ—à–∏–±–∫–æ–π:
timeout /t 1 /nobreak >nul
echo 1. üì± –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑... ‚úì
timeout /t 1 /nobreak >nul
echo 2. üì¶ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã... ‚úì
timeout /t 1 /nobreak >nul
echo 3. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ú–æ–ª–æ–∫–æ... ‚úì
timeout /t 1 /nobreak >nul
echo 4. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –•–ª–µ–±... ‚úì
timeout /t 1 /nobreak >nul
echo 5. üë∑ –ò—â–µ—Ç –ô–æ–≥—É—Ä—Ç... ‚ùå –ù–ï –ù–ê–ô–î–ï–ù–û!
timeout /t 2 /nobreak >nul
echo 6. üìû –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ—Ñ–∏—Å... ‚è≥
timeout /t 2 /nobreak >nul
echo 7. üì± –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç—É: \"–ô–æ–≥—É—Ä—Ç–∞ –Ω–µ—Ç. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?\"... ‚è≥
timeout /t 2 /nobreak >nul
echo 8. üë§ –ö–ª–∏–µ–Ω—Ç: \"–î–∞, –±–µ–∑ –π–æ–≥—É—Ä—Ç–∞\"... ‚úì
timeout /t 1 /nobreak >nul
echo 9. üöö –ö—É—Ä—å–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–∫–∞–∑... ‚úì
timeout /t 1 /nobreak >nul
echo 10. üè† –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–∫–∞–∑... ‚úì
echo.
echo ‚ö† –ó–ê–ö–ê–ó –ß–ê–°–¢–ò–ß–ù–û –í–´–ü–û–õ–ù–ï–ù
echo ‚è±Ô∏è –í—Ä–µ–º—è: 30 –º–∏–Ω—É—Ç (+100%)
echo üí∞ –í–æ–∑–≤—Ä–∞—Ç: 119.98 —Ä—É–± –∑–∞ –π–æ–≥—É—Ä—Ç
echo üòê –ö–ª–∏–µ–Ω—Ç —Å–ª–µ–≥–∫–∞ –Ω–µ–¥–æ–≤–æ–ª–µ–Ω
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 4. –°–¶–ï–ù–ê–†–ò–ô 3: –ö–ê–°–ö–ê–î–ù–´–ï –û–®–ò–ë–ö–ò (–ì–õ–ê–í–ù–´–ô)
:: ==============================================================================
:SCENARIO_3
cls
echo ================================================================================
echo üî• –°–¶–ï–ù–ê–†–ò–ô 3: –ö–ê–°–ö–ê–î–ù–´–ï –û–®–ò–ë–ö–ò (–°–ö–†–´–¢–´–ï –î–ï–§–ò–¶–ò–¢–´)
echo ================================================================================
echo.

echo ‚ö† –≠–¢–û –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ö–û–¢–û–†–£–Æ –ú–´ –î–ï–ú–û–ù–°–¢–†–ò–†–£–ï–ú!
echo üì¶ –ë–û–õ–¨–®–û–ô –ó–ê–ö–ê–ó: –ú–æ–ª–æ–∫–æ, –•–ª–µ–±, –ú–∞—Å–ª–æ, –Ø–π—Ü–∞, –°—ã—Ä, –ô–æ–≥—É—Ä—Ç
echo.

echo üîÑ –ü–†–û–¶–ï–°–° –° –ö–ê–¢–ê–°–¢–†–û–§–ò–ß–ï–°–ö–ò–ú–ò –ü–û–°–õ–ï–î–°–¢–í–ò–Ø–ú–ò:
echo.
timeout /t 1 /nobreak >nul
echo 1. üì± –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –Ω–∞ 6 —Ç–æ–≤–∞—Ä–æ–≤... ‚úì
timeout /t 1 /nobreak >nul
echo 2. üì¶ –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: \"–í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏\"... ‚ö† (–õ–û–ñ–¨!)
timeout /t 1 /nobreak >nul
echo 3. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ú–æ–ª–æ–∫–æ... ‚úì
timeout /t 1 /nobreak >nul
echo 4. üë∑ –°–±–æ—Ä—â–∏–∫ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –•–ª–µ–±... ‚úì
timeout /t 1 /nobreak >nul
echo 5. üë∑ –ò—â–µ—Ç –ô–æ–≥—É—Ä—Ç... ‚ùå –ù–ï –ù–ê–ô–î–ï–ù–û!
echo.
echo ‚è≥ –ù–ê–ß–ò–ù–ê–ï–¢–°–Ø –ö–ê–¢–ê–°–¢–†–û–§–ê...
echo üìû –°–±–æ—Ä—â–∏–∫ —Å–æ–æ–±—â–∞–µ—Ç –≤ –æ—Ñ–∏—Å –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –π–æ–≥—É—Ä—Ç–∞
echo üì± –û—Ñ–∏—Å —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º
echo ‚è∞ –ü–†–û–®–õ–û 15 –ú–ò–ù–£–¢...
echo.
echo üí• –ü–†–û–ë–õ–ï–ú–ê: –ó–∞ 15 –º–∏–Ω—É—Ç –¥—Ä—É–≥–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –∑–∞–±—Ä–∞–ª–∏:
echo - –Ø–π—Ü–∞ (–±—ã–ª–æ 10, –Ω—É–∂–Ω–æ 10) ‚Üí –æ—Å—Ç–∞–ª–æ—Å—å 3
echo - –°—ã—Ä (–±—ã–ª–æ 5, –Ω—É–∂–Ω–æ 5) ‚Üí –æ—Å—Ç–∞–ª–æ—Å—å 1
echo - –ú–∞—Å–ª–æ (–±—ã–ª–æ 3, –Ω—É–∂–Ω–æ 3) ‚Üí –æ—Å—Ç–∞–ª–æ—Å—å 1
echo.
echo üìä –ò–¢–û–ì –î–û –û–®–ò–ë–ö–ò:
echo - –ù–µ—Ç: –ô–æ–≥—É—Ä—Ç (—è–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
echo - –ö–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –±–µ–∑ –π–æ–≥—É—Ä—Ç–∞
echo.
echo üìä –†–ï–ê–õ–¨–ù–´–ô –ò–¢–û–ì:
echo - –ù–µ—Ç: –ô–æ–≥—É—Ä—Ç, –Ø–π—Ü–∞ (7 —à—Ç), –°—ã—Ä (4 —à—Ç), –ú–∞—Å–ª–æ (2 —à—Ç)
echo - –ï—Å—Ç—å: –¢–æ–ª—å–∫–æ –ú–æ–ª–æ–∫–æ –∏ –•–ª–µ–± (2 –∏–∑ 6 —Ç–æ–≤–∞—Ä–æ–≤!)
echo.
echo üò° –ö–õ–ò–ï–ù–¢ –ü–û–õ–£–ß–ê–ï–¢ –¢–û–õ–¨–ö–û 33%% –¢–û–í–ê–†–û–í!
echo üí∞ –ü–û–¢–ï–†–ò: 1,689.92 —Ä—É–± –∏–∑ 2,184.87 —Ä—É–±
echo ‚è±Ô∏è –ü–û–¢–ï–†–Ø–ù–û–ï –í–†–ï–ú–Ø: 45+ –º–∏–Ω—É—Ç
echo ‚öñÔ∏è –Æ–†–ò–î–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò: –í–´–°–û–ö–ò–ï
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 5. –°–¶–ï–ù–ê–†–ò–ô 4: –ö–õ–ò–ï–ù–¢ –¢–†–ï–ë–£–ï–¢ –í–°–ï –¢–û–í–ê–†–´
:: ==============================================================================
:SCENARIO_4
cls
echo ================================================================================
echo üèÉ –°–¶–ï–ù–ê–†–ò–ô 4: –ö–õ–ò–ï–ù–¢ –¢–†–ï–ë–£–ï–¢ –í–°–ï –¢–û–í–ê–†–´
echo ================================================================================
echo.

echo üëë –ö–õ–ò–ï–ù–¢ –ù–ê–°–¢–ê–ò–í–ê–ï–¢: \"–Ø –ó–ê–ü–õ–ê–¢–ò–õ - –•–û–ß–£ –í–°–ï –¢–û–í–ê–†–´!\"
echo.
echo üîÑ –ü–†–û–¶–ï–°–° –ü–û–ò–°–ö–ê –ù–ê –î–†–£–ì–ò–• –°–ö–õ–ê–î–ê–•:
echo.
echo 1. üîé –ü–æ–∏—Å–∫ –π–æ–≥—É—Ä—Ç–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–∫–ª–∞–¥–∞—Ö... ‚è≥
timeout /t 2 /nobreak >nul
echo 2. ‚úÖ –ù–∞–π–¥–µ–Ω –π–æ–≥—É—Ä—Ç –Ω–∞ —Ö–æ–ª–æ–¥–Ω–æ–º —Å–∫–ª–∞–¥–µ (15 –∫–º)... ‚úì
timeout /t 1 /nobreak >nul
echo 3. üöö –ú–µ–∂—Å–∫–ª–∞–¥—Å–∫–∞—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞... 50 –º–∏–Ω—É—Ç
timeout /t 1 /nobreak >nul
echo 4. üí∞ –î–æ–ø. –∑–∞—Ç—Ä–∞—Ç—ã: 700 —Ä—É–± (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç + —Ä—É—á–Ω–æ–π —Ç—Ä—É–¥)
timeout /t 1 /nobreak >nul
echo 5. üîé –ü–æ–∏—Å–∫ —è–∏—Ü –∏ —Å—ã—Ä–∞... ‚ùå –ù–ï –ù–ê–ô–î–ï–ù–´
timeout /t 1 /nobreak >nul
echo 6. üìû –ü–æ–∏—Å–∫ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤... ‚è≥
timeout /t 2 /nobreak >nul
echo 7. ‚úÖ –ü–æ—Å—Ç–∞–≤—â–∏–∫ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ 3 —á–∞—Å–∞... ‚úì
echo.
echo üìä –ò–¢–û–ì:
echo - –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª –í–°–ï —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ 4+ —á–∞—Å–∞
echo - –î–æ–ø. –∑–∞—Ç—Ä–∞—Ç—ã: 1,200+ —Ä—É–±–ª–µ–π
echo - –ò–∑–Ω–æ—Å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
echo - üò† –ö–ª–∏–µ–Ω—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ–¥–æ–≤–æ–ª–µ–Ω –¥–æ–ª–≥–∏–º –æ–∂–∏–¥–∞–Ω–∏–µ–º
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 6. –°–¶–ï–ù–ê–†–ò–ô 5: –ù–û–ß–ù–û–ô –ö–û–®–ú–ê–†
:: ==============================================================================
:SCENARIO_5
cls
echo ================================================================================
echo üåô –°–¶–ï–ù–ê–†–ò–ô 5: –ù–û–ß–ù–û–ô –ö–û–®–ú–ê–† (–ú–ê–ì–ê–ó–ò–ù–´ –ó–ê–ö–†–´–¢–´)
echo ================================================================================
echo.

echo üïñ –í–†–ï–ú–Ø: 19:45 | –ú–∞–≥–∞–∑–∏–Ω—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ 20:00
echo üéâ –ö–õ–ò–ï–ù–¢: \"–ì–û–°–¢–ò –ß–ï–†–ï–ó 15 –ú–ò–ù–£–¢! –ù–£–ñ–ù–´ –í–°–ï –¢–û–í–ê–†–´!\"
echo.
echo ‚è≥ –•–†–û–ù–ò–ö–ê –ö–ê–¢–ê–°–¢–†–û–§–´:
echo.
echo 19:46 üì± –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
echo 19:50 üë∑ –û–±–Ω–∞—Ä—É–∂–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –π–æ–≥—É—Ä—Ç
echo 19:55 üìû –ö–ª–∏–µ–Ω—Ç—É: \"–ô–æ–≥—É—Ä—Ç–∞ –Ω–µ—Ç. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?\"
echo 19:58 üë§ –ö–ª–∏–µ–Ω—Ç: \"–ù–ê–ô–î–ò–¢–ï –ô–û–ì–£–†–¢! –ì–û–°–¢–ò –°–ö–û–†–û!\"
echo 20:00 üö´ –ú–ê–ì–ê–ó–ò–ù–´ –ó–ê–ö–†–´–¢–´
echo 20:05 üîé –í—Å–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏: –ó–ê–ö–†–´–¢–´
echo 20:15 üéâ –ì–û–°–¢–ò –ü–†–ò–®–õ–ò
echo 20:30 üò° –ì–û–°–¢–ò –£–®–õ–ò –†–ê–ó–û–ß–ê–†–û–í–ê–ù–ù–´–ú–ò
echo.
echo üí• –§–ò–ù–ê–ù–°–û–í–´–ï –ü–û–¢–ï–†–ò:
echo - –í–æ–∑–≤—Ä–∞—Ç –∑–∞–∫–∞–∑–∞: 2,184.87 —Ä—É–±
echo - –ü–æ—Ç–µ—Ä—è –∫–ª–∏–µ–Ω—Ç–∞: 5,000+ —Ä—É–± (–ø–æ–∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å)
echo - –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —É—â–µ—Ä–±: 10,000+ —Ä—É–±
echo - –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏: 8,000+ —Ä—É–±
echo.
echo üìà –ò–¢–û–ì–û: ~25,000 –†–£–ë–õ–ï–ô –£–ë–´–¢–ö–ê –û–¢ –û–î–ù–û–ô –û–®–ò–ë–ö–ò!
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 7. –ü–û–ö–ê–ó–ê–¢–¨ –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´
:: ==============================================================================
:SHOW_STATE
cls
echo ================================================================================
echo üìà –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´
echo ================================================================================
echo.

if "%DB_AVAILABLE%"=="1" (
    echo üè™ –¢–û–í–ê–†–´ –í –ë–î %DB_NAME%:
    call :PSQL_WITH_PASSWORD "
    SELECT 
        product_id as \"–¢–æ–≤–∞—Ä\",
        name as \"–ù–∞–∑–≤–∞–Ω–∏–µ\",
        stock as \"–û—Å—Ç–∞—Ç–æ–∫\",
        CASE 
            WHEN stock = 0 THEN '‚ùå –ù–ï–¢'
            WHEN stock < 3 THEN 'üî¥ –û–ß–ï–ù–¨ –ú–ê–õ–û'
            WHEN stock < 10 THEN 'üü° –ú–ê–õ–û'
            ELSE 'üü¢ –ï–°–¢–¨'
        END as \"–°—Ç–∞—Ç—É—Å\",
        warehouse as \"–°–∫–ª–∞–¥\"
    FROM products 
    ORDER BY stock, product_id;
    " 2>nul
) else (
    echo üè™ –¢–û–í–ê–†–´ (—Å–∏–º—É–ª—è—Ü–∏—è):
    echo.
    echo üü¢ –ú–æ–ª–æ–∫–æ 1–ª: 50 —à—Ç
    echo üü¢ –•–ª–µ–±: 30 —à—Ç
    echo üü° –ú–∞—Å–ª–æ: 5 —à—Ç
    echo üî¥ –Ø–π—Ü–∞: 1 —à—Ç
    echo üü° –°—ã—Ä: 2 —à—Ç
    echo ‚ùå –ô–æ–≥—É—Ä—Ç: 0 —à—Ç
    echo üü¢ –û–≤–æ—â–∏: 60 —à—Ç
    echo üü¢ –§—Ä—É–∫—Ç—ã: 35 —à—Ç
    echo üü¢ –í–æ–¥–∞: 100 —à—Ç
)

echo.
echo üë• –¢–ï–ö–£–©–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò:
echo - –ö–ª–∏–µ–Ω—Ç: %CLIENT_ID%
echo - –°–±–æ—Ä—â–∏–∫: %COLLECTOR_ID%
echo - –ó–∞–∫–∞–∑: %ORDER_ID%
echo.
echo ‚öôÔ∏è –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´:
if "%SAGA_AVAILABLE%"=="1" (
    echo - Transaction Saga: üü¢ –†–ê–ë–û–¢–ê–ï–¢
) else (
    echo - Transaction Saga: üü° –°–ò–ú–£–õ–Ø–¶–ò–Ø
)

if "%DB_AVAILABLE%"=="1" (
    echo - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: üü¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ê
) else (
    echo - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: üü° –°–ò–ú–£–õ–Ø–¶–ò–Ø
)

echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 8. –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–•
:: ==============================================================================
:CLEAR_DATA
cls
echo ================================================================================
echo üßπ –û–ß–ò–°–¢–ö–ê –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–•
echo ================================================================================
echo.

set /p CONFIRM="‚ùì –í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã (y/n): "
if /i not "%CONFIRM%"=="y" goto MAIN_MENU

echo.
if "%DB_AVAILABLE%"=="1" (
    echo üóëÔ∏è –û—á–∏—â–∞–µ–º –ë–î...
    call :PSQL_WITH_PASSWORD "
    DROP TABLE IF EXISTS order_items;
    DROP TABLE IF EXISTS orders;
    DROP TABLE IF EXISTS products;
    " 2>nul && echo ‚úÖ –¢–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã
) else (
    echo ‚úÖ –°–∏–º—É–ª—è—Ü–∏—è: –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã
)

echo.
echo ‚ôªÔ∏è –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ...
set CLIENT_ID=CLIENT-%RANDOM%
set COLLECTOR_ID=COLLECTOR-%RANDOM%
set ORDER_ID=ORDER-%RANDOM%-%TIME:~6,2%
echo ‚úÖ –ù–æ–≤—ã–µ ID —Å–æ–∑–¥–∞–Ω—ã
echo.
pause
goto MAIN_MENU

:: ==============================================================================
:: 9. –ü–ï–†–ï–ó–ê–ü–£–°–ö –î–ï–ú–û
:: ==============================================================================
:RESTART_DEMO
cls
echo ================================================================================
echo üîÑ –ü–ï–†–ï–ó–ê–ü–£–°–ö –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò
echo ================================================================================
echo.
echo –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ...
timeout /t 2 /nobreak >nul
cls
goto :EOF

:: ==============================================================================
:: –ö–û–ù–ï–¶ –°–ö–†–ò–ü–¢–ê
:: ==============================================================================